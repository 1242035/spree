<% content_for :page_title do %>
  <%= link_to Viauco.t(:orders), admin_orders_path %> /
  <%= link_to @order.number, viauco.edit_admin_order_path(@order) %>
<% end %>

<% content_for :sidebar do %>
  <ul class="nav flex-column nav-pills" data-hook="admin_order_tabs">
    <% if ((can? :update, @order) && (@order.shipments.size.zero? || @order.shipments.shipped.size.zero?)) %>
      <li data-hook='admin_order_tabs_cart_details'>
        <%= link_to_with_icon 'edit',
          Viauco.t(:cart),
          cart_admin_order_url(@order),
          class: "#{'active' if current == :cart} nav-link" %>
      </li>
    <% end %>

    <% if ((can?(:update, @order) && can?(:read, Viauco::Store)) && (@order.shipments.size.zero? || @order.shipments.shipped.size.zero?)) %>
      <li data-hook='admin_order_tabs_store_details'>
        <%= link_to_with_icon 'home',
          Viauco.t(:store),
          store_admin_order_url(@order),
          class: "#{'active' if current == :store} nav-link" %>
      </li>
    <% end %>

    <% if can?(:update, @order) && @order.checkout_steps.include?("address") %>
      <li data-hook='admin_order_tabs_customer_details'>
        <%= link_to_with_icon 'user',
          Viauco.t(:customer),
          viauco.admin_order_customer_url(@order),
          class: "#{'active' if current == :customer_details} nav-link" %>
      </li>
    <% end %>

    <% if can? :update, @order %>
      <li data-hook='admin_order_tabs_shipment_details'>
        <%= link_to_with_icon 'road',
          Viauco.t(:shipments),
          edit_admin_order_url(@order),
          class: "#{'active' if current == :shipments} nav-link" %>
      </li>
    <% end %>

    <% if can? :index, Viauco::Adjustment %>
      <li data-hook='admin_order_tabs_adjustments'>
        <%= link_to_with_icon 'wrench',
          Viauco.t(:adjustments),
          viauco.admin_order_adjustments_url(@order),
          class: "#{'active' if current == :adjustments} nav-link" %>
      </li>
    <% end %>

    <% if can?(:index, Viauco::Payment) %>
      <li data-hook='admin_order_tabs_payments'>
        <%= link_to_with_icon 'credit-card',
          Viauco.t(:payments),
          viauco.admin_order_payments_url(@order),
          class: "#{'active' if current == :payments} nav-link" %>
      </li>
    <% end %>

    <% if can? :index, Viauco::ReturnAuthorization %>
      <% if @order.completed? %>
        <li data-hook='admin_order_tabs_return_authorizations'>
          <%= link_to_with_icon 'transfer',
            Viauco.t(:return_authorizations),
            viauco.admin_order_return_authorizations_url(@order),
            class: "#{'active' if current == :return_authorizations} nav-link" %>
        </li>
      <% end %>
    <% end %>

    <% if can? :index, Viauco::CustomerReturn %>
      <% if @order.completed? %>
        <li>
          <%= link_to_with_icon 'transfer',
            Viauco.t(:customer_returns),
            viauco.admin_order_customer_returns_url(@order),
            class: "#{'active' if current == :customer_returns} nav-link" %>
        </li>
      <% end %>
    <% end %>

    <% if can? :update, @order %>
      <li data-hook='admin_order_tabs_state_changes'>
        <%= link_to_with_icon 'refresh',
          Viauco::StateChange.human_attribute_name(:state_changes),
          viauco.admin_order_state_changes_url(@order),
          class: "#{'active' if current == :state_changes} nav-link" %>
      </li>
    <% end %>
  </ul>
<% end %>
